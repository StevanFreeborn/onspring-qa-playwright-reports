<!DOCTYPE html>
<html lang="en">

<%- include('../partials/_head', { title: locals.title, styles: locals.styles, scripts: locals.scripts }) %>

<body>

  <%- include('../partials/_header') %>

  <main>
    <div class="chip">
      <div class="chip-header">
        <h2>ðŸŽ­ Playwright Reports</h2>
      </div>
      <div class="chip-body chip-body-no-insets">
        <% if (reports && reports.length) { %>
        <div class="test-wrapper">
          <% reports.forEach(report => { %>
          <div class="test-file-test">
            <a href="/reports/<%= report.path %>/">
              Playwright Report <span class="report-date" data-date-in-ms="<%= report.date %>"><%= new Date(report.date).toLocaleString() %></span>
            </a>
            <span class="label <%= report.environment.toLowerCase() %>">
              <%= report.environment %>
            </span>
            <span class="label <%= report.status %>">
              <%= report.status %>
            </span>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <p>No reports found.</p>
        <% } %>
      </div>
    </div>
  </main>
</body>

<script>
  document.getElementById('logout').addEventListener('click', logOutUser);
  const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

  async function logOutUser() {
    const response = await fetch('/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        _csrf: csrfToken,
      }),
    });

    if (response.redirected) {
      window.location.href = response.url;
    }
  }
</script>

</html>