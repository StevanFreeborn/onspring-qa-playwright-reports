<!DOCTYPE html>
<html lang="en">

<%- include('../partials/_head', { title: title, styles: styles ?? [] }) %>

<body>
  <main>
    <div class="header-container">
      <h1>Playwright Reports</h1>
      <button class="logout-button" type="button" id="logout">Log out</button>
    </div>
    <div class="chip">
      <div class="chip-header">
        <h3>Reports</h3>
      </div>
      <div class="chip-body chip-body-no-insets">
        <% if (reports && reports.length) { %>
        <div class="test-wrapper">
          <% reports.forEach(report => { %>
          <div class="test-file-test">
            <a href="/reports/<%= report %>">
              Playwright Report <%= report %>
            </a>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <p>No reports found.</p>
        <% } %>
      </div>
    </div>
  </main>
</body>

<script>
  document.getElementById('logout').addEventListener('click', logOutUser);
  const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

  async function logOutUser() {
    const response = await fetch('/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        _csrf: csrfToken,
      }),
    });

    if (response.redirected) {
      window.location.href = response.url;
    }
  }
</script>

</html>